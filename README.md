# ✈️ برنامه‌ریز پرواز با CSP

## معرفی پروژه

در این پروژه تلاش شده مسئله‌ی پیدا کردن یک برنامه‌ی سفر هوایی معتبر و ارزان، به‌صورت یک **مسئله ارضای محدودیت‌ها (CSP)** مدل‌سازی و حل شود. هدف این است که با توجه به مسیر مشخص‌شده بین شهرها، پروازهایی انتخاب شوند که هم از نظر زمانی معتبر باشند و هم هزینه‌ی کل آن‌ها در بازه‌ی بودجه‌ی مسافر قرار بگیرد.

برای حل مسئله از **جستجوی عقب‌گرد (Backtracking Search)** استفاده شده و به‌منظور بهبود عملکرد، تکنیک **Forward Checking** پس از هر مقداردهی اعمال می‌شود.

---

## مدل‌سازی CSP

### متغیرها

هر متغیر نشان‌دهنده‌ی یک پرواز بین دو شهر متوالی در مسیر سفر است.

اگر مسیر شامل `N` شهر باشد، تعداد متغیرها برابر با `N-1` خواهد بود:

* متغیر ۰: پرواز از شهر اول به شهر دوم
* متغیر ۱: پرواز از شهر دوم به شهر سوم
* و به همین ترتیب

---

### دامنه متغیرها

دامنه‌ی هر متغیر شامل تمام پروازهایی است که **مبدأ و مقصد آن‌ها دقیقاً مطابق با آن بخش از مسیر سفر** باشد. این دامنه‌ها در ابتدای برنامه و با استفاده از لیست پروازهای ورودی ساخته می‌شوند.

---

### محدودیت‌ها

#### ۱. محدودیت زمانی اقامت (Time Window)

بین دو پرواز متوالی، مدت اقامت مسافر در شهر میانی باید در بازه‌ی مشخص‌شده قرار بگیرد:

```
min_stay ≤ (روز پرواز بعدی − روز پرواز قبلی) ≤ max_stay
```

این محدودیت:

* هنگام مقداردهی با تابع `is_consistent` بررسی می‌شود
* و پس از هر مقداردهی با **Forward Checking** روی دامنه‌ی متغیر بعدی اعمال می‌شود

---

#### ۲. محدودیت بودجه (Budget Window)

مجموع قیمت تمام پروازهای انتخاب‌شده باید در بازه‌ی زیر باشد:

```
MinPrice ≤ TotalCost ≤ MaxPrice
```

طبق صورت پروژه، این محدودیت **در Forward Checking اعمال نمی‌شود** و فقط پس از کامل شدن مقداردهی همه‌ی متغیرها بررسی می‌شود.

---

## الگوریتم حل

### جستجوی عقب‌گرد (Backtracking)

الگوریتم به‌صورت بازگشتی، برای هر متغیر یک پرواز از دامنه‌اش انتخاب می‌کند. اگر در هر مرحله محدودیت‌ها نقض شوند یا دامنه‌ی آینده خالی شود، الگوریتم به مرحله قبل بازمی‌گردد (Backtrack).

---

### Forward Checking

پس از مقداردهی هر متغیر:

* دامنه‌ی متغیر بعدی بررسی می‌شود
* پروازهایی که از نظر محدودیت زمانی ناسازگار هستند حذف می‌شوند
* اگر دامنه‌ی متغیر بعدی خالی شود، شکست زودهنگام تشخیص داده می‌شود

این کار باعث کاهش قابل توجه فضای جستجو می‌شود.

---

## ساختار کد

```
.
├── Flight.py        # تعریف کلاس Flight
├── input.py         # خواندن ورودی و ساخت دامنه‌ها
├── csp.py           # پیاده‌سازی حل‌کننده CSP
└── main.py          # نقطه شروع اجرای برنامه
```

---

## توضیح فایل‌ها

### Flight.py

کلاس `Flight` اطلاعات هر پرواز را نگه‌داری می‌کند:

* مبدأ
* مقصد
* روز پرواز
* قیمت

---

### input.py

* خواندن ورودی‌ها از stdin
* تبدیل داده‌ها به ساختار مناسب
* ساخت دامنه‌ی متغیرها بر اساس مسیر شهرها

---

### csp.py

شامل کلاس `CSPSolver` که منطق اصلی حل مسئله در آن پیاده‌سازی شده است:

* `is_consistent` : بررسی سازگاری زمانی با پرواز قبلی
* `forward_checking` : حذف مقادیر ناسازگار از دامنه‌ی متغیر بعدی
* `backtracking_search` : جستجوی بازگشتی پاسخ
* `solve` : اجرای حل‌کننده و ثبت زمان اجرا

---

### main.py

* فراخوانی توابع ورودی
* اجرای حل‌کننده CSP
* چاپ مسیر نهایی، هزینه کل، تعداد backtrackها و زمان اجرا

---

## خروجی برنامه

در صورت یافتن جواب:

* پروازهای انتخاب‌شده به‌ترتیب چاپ می‌شوند
* هزینه‌ی کل نمایش داده می‌شود
* تعداد Backtrack و زمان اجرا گزارش می‌شود

در غیر این صورت، پیام زیر چاپ خواهد شد:

